---
/**
 * NavSection.astro
 *
 * Collapsible navigation section with:
 * - SVG chevron icons (not Unicode)
 * - Proper ARIA attributes for accessibility
 * - Starts collapsed, JS expands based on localStorage
 */

interface Props {
  sectionId: string;
  title: string;
  items: Array<{ title: string; href: string }>;
  currentPath?: string;
}

const { sectionId, title, items, currentPath = '' } = Astro.props;

// Check if any item in this section is active
const hasActiveItem = items.some((item) => currentPath === item.href);
---

<div 
  class="nav-section" 
  data-section={sectionId}
  data-has-active={hasActiveItem ? 'true' : 'false'}
>
  <button
    type="button"
    class="nav-section-header"
    aria-expanded="false"
    aria-controls={`section-${sectionId}`}
  >
    <span class="nav-section-title">
      {title}
    </span>
    <svg 
      class="nav-section-chevron" 
      width="16" 
      height="16" 
      viewBox="0 0 16 16" 
      fill="none"
      aria-hidden="true"
    >
      <path 
        d="M6 4L10 8L6 12" 
        stroke="currentColor" 
        stroke-width="1.5" 
        stroke-linecap="round" 
        stroke-linejoin="round"
      />
    </svg>
  </button>
  <div 
    class="nav-section-content" 
    id={`section-${sectionId}`}
    role="group"
    aria-label={`${title} navigation items`}
  >
    <div class="nav-section-items">
      {items.map((item, index) => (
        <a
          href={item.href}
          class:list={['nav-item', { active: currentPath === item.href }]}
          data-nav-item
          tabindex={currentPath === item.href ? 0 : -1}
          aria-current={currentPath === item.href ? 'page' : undefined}
        >
          {item.title}
        </a>
      ))}
    </div>
  </div>
</div>

<style>
  .nav-section {
    margin-bottom: 0.25rem;
  }

  .nav-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 0.5rem 0.75rem;
    background: transparent;
    border: none;
    border-radius: 0.375rem;
    cursor: pointer;
    transition: background-color 0.15s ease;
  }

  .nav-section-header:hover {
    background-color: var(--color-bg-tertiary);
  }

  .nav-section-header:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: -2px;
    background-color: var(--color-bg-tertiary);
  }

  .nav-section-title {
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-tertiary);
  }

  .nav-section-chevron {
    flex-shrink: 0;
    color: var(--color-text-tertiary);
    transition: transform 0.2s ease-out;
  }

  /* Expanded state - chevron rotates 90deg */
  .nav-section.expanded .nav-section-chevron {
    transform: rotate(90deg);
  }

  /* Subtle left indicator when section has active item */
  .nav-section[data-has-active="true"] .nav-section-header {
    border-left: 2px solid var(--color-accent);
    padding-left: calc(0.75rem - 2px);
  }

  .nav-section-content {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.26s ease-out;
  }

  .nav-section.expanded .nav-section-content {
    grid-template-rows: 1fr;
  }

  .nav-section-items {
    overflow: hidden;
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    padding-left: 0.75rem;
    margin-left: 0.5rem;
    border-left: 1px solid var(--color-border);
  }

  /* Add top padding only when expanded */
  .nav-section.expanded .nav-section-items {
    padding-top: 0.25rem;
    padding-bottom: 0.25rem;
  }
</style>
