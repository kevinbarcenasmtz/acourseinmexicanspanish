---
/**
 * ThemeToggle.astro
 *
 * Dark/light mode toggle button with:
 * - Sun/moon icons
 * - localStorage persistence
 * - System preference detection
 * - Smooth transition
 */

 interface Props {
  /** Show text label alongside icon */
  showLabel?: boolean;
  /** Button variant: 'icon' for icon-only, 'button' for full width */
  variant?: 'icon' | 'button';
}

const { showLabel = true, variant = 'button' } = Astro.props;
---

<button
  type="button"
  id="theme-toggle"
  class:list={[
    'theme-toggle-btn',
    { 'theme-toggle-icon-only': variant === 'icon' },
  ]}
  aria-label="Toggle dark mode"
>
  <!-- Sun icon (shown in dark mode) -->
  <svg
    class="theme-icon theme-icon-sun"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
    aria-hidden="true"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
    />
  </svg>

  <!-- Moon icon (shown in light mode) -->
  <svg
    class="theme-icon theme-icon-moon"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
    aria-hidden="true"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
    />
  </svg>

  {showLabel && (
    <>
      <span class="theme-label theme-label-light">Dark Mode</span>
      <span class="theme-label theme-label-dark">Light Mode</span>
    </>
  )}
</button>

<script>
  function initThemeToggle() {
    const toggleButton = document.getElementById('theme-toggle');
    if (!toggleButton) return;

    toggleButton.addEventListener('click', () => {
      const isDark = document.documentElement.classList.contains('dark');

      if (isDark) {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      } else {
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      }
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initThemeToggle);
  } else {
    initThemeToggle();
  }

  document.addEventListener('astro:after-swap', initThemeToggle);
</script>

<style>
  .theme-toggle-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background-color: transparent;
    border: none;
    border-radius: 0.375rem;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition:
      background-color var(--transition-fast),
      color var(--transition-fast);
    width: 100%;
    justify-content: flex-start;
  }

  .theme-toggle-btn:hover {
    background-color: var(--color-bg-tertiary);
    color: var(--color-text-primary);
  }

  .theme-toggle-icon-only {
    width: 2.5rem;
    height: 2.5rem;
    padding: 0;
    justify-content: center;
  }

  .theme-icon {
    width: 1rem;
    height: 1rem;
    flex-shrink: 0;
  }

  /* Light mode: show moon, hide sun */
  .theme-icon-sun { display: none; }
  .theme-icon-moon { display: block; }
  .theme-label-light { display: block; }
  .theme-label-dark { display: none; }

  /* Dark mode: show sun, hide moon */
  :global(.dark) .theme-icon-sun { display: block; }
  :global(.dark) .theme-icon-moon { display: none; }
  :global(.dark) .theme-label-light { display: none; }
  :global(.dark) .theme-label-dark { display: block; }
</style>